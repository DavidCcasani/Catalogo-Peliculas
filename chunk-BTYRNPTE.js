import{c as y,d as x,f as h,g as E}from"./chunk-MPFUNZLY.js";import{a as V}from"./chunk-VRVQKTDE.js";import{a as N,b as p,c as w,d as R,g as F,h as j,i as k,j as G,o as z,q as Y}from"./chunk-TRMJWQRB.js";import{a as q}from"./chunk-RPCMMASC.js";import{A as s,D as f,Da as D,F as I,K as m,P as d,Q as i,R as e,S as u,W as b,X as M,_ as r,qa as S,ra as O,xa as A,z as C,za as T}from"./chunk-J5HE3GJU.js";function B(n,o){n&1&&(i(0,"div",20),r(1,` Pel\xEDcula actualizada correctamente
`),e())}function L(n,o){n&1&&(i(0,"div",21),r(1," El t\xEDtulo es obligatorio. "),e())}function U(n,o){n&1&&(i(0,"div",21),r(1," El g\xE9nero es obligatorio. "),e())}function $(n,o){n&1&&(i(0,"div",21),r(1," El a\xF1o debe ser mayor a 1900. "),e())}function H(n,o){n&1&&(i(0,"div",21),r(1," El director es obligatorio. "),e())}function J(n,o){if(n&1&&u(0,"img",22),n&2){let l,t=M();d("src",(l=t.formulario.get("imagen"))==null?null:l.value,C)}}var v=class n{constructor(o,l,t,a){this.route=o;this.peliculasService=l;this.router=t;this.fb=a}peliculaId="";formulario;mostrarToast=!1;ngOnInit(){this.peliculaId=this.route.snapshot.paramMap.get("id")||"",this.formulario=this.fb.group({titulo:["",p.required],genero:["",p.required],anio:[new Date().getFullYear(),[p.required,p.min(1900)]],director:["",p.required],descripcion:[""],imagen:[""]}),this.peliculasService.getPelicula(this.peliculaId).subscribe(o=>{o&&this.formulario.patchValue(o)})}guardarCambios(){this.formulario.valid?this.peliculasService.editarPelicula(this.peliculaId,this.formulario.value).then(()=>{this.mostrarToast=!0,setTimeout(()=>{this.mostrarToast=!1,this.router.navigate(["/peliculas"])},2e3)}).catch(o=>{alert("Error al actualizar: "+o.message)}):alert("Completa todos los campos correctamente")}subiendoImagen=!1;uploadImage(o){let l=o.target.files?.[0];if(!l)return;let t=new FormData;t.append("file",l),t.append("upload_preset","Imagenes"),fetch("https://api.cloudinary.com/v1_1/dbezo9ehh/image/upload",{method:"POST",body:t}).then(a=>a.json()).then(a=>{console.log("\u2705 Imagen subida:",a.secure_url),this.formulario.patchValue({imagen:a.secure_url}),console.log("\u{1F504} Nuevo valor imagen:",this.formulario.get("imagen")?.value)}).catch(a=>{console.error("\u274C Error al subir imagen:",a),alert("Error al subir la imagen")})}static \u0275fac=function(l){return new(l||n)(f(A),f(q),f(T),f(z))};static \u0275cmp=I({type:n,selectors:[["app-editar-pelicula"]],decls:40,vars:9,consts:[["class","toast",4,"ngIf"],[1,"formulario",3,"ngSubmit","formGroup"],[1,"campo"],["for","titulo"],["id","titulo","type","text","formControlName","titulo"],["class","error",4,"ngIf"],["for","genero"],["id","genero","type","text","formControlName","genero"],["for","anio"],["id","anio","type","number","formControlName","anio"],["for","director"],["id","director","type","text","formControlName","director"],["for","descripcion"],["id","descripcion","formControlName","descripcion"],["for","imagen"],["width","150",3,"src",4,"ngIf"],["for","imagenNueva"],["type","file","id","imagenNueva",3,"change"],[1,"boton-centrado"],["type","submit",3,"disabled"],[1,"toast"],[1,"error"],["width","150",3,"src"]],template:function(l,t){if(l&1&&(i(0,"div")(1,"h2"),r(2,"Editar Pel\xEDcula"),e(),m(3,B,2,0,"div",0),i(4,"form",1),b("ngSubmit",function(){return t.guardarCambios()}),i(5,"div",2)(6,"label",3),r(7,"T\xEDtulo:"),e(),u(8,"input",4),m(9,L,2,0,"div",5),e(),i(10,"div",2)(11,"label",6),r(12,"G\xE9nero:"),e(),u(13,"input",7),m(14,U,2,0,"div",5),e(),i(15,"div",2)(16,"label",8),r(17,"A\xF1o:"),e(),u(18,"input",9),m(19,$,2,0,"div",5),e(),i(20,"div",2)(21,"label",10),r(22,"Director:"),e(),u(23,"input",11),m(24,H,2,0,"div",5),e(),i(25,"div",2)(26,"label",12),r(27,"Descripci\xF3n:"),e(),u(28,"textarea",13),e(),i(29,"div",2)(30,"label",14),r(31,"Imagen actual:"),e(),m(32,J,1,1,"img",15),e(),i(33,"div",2)(34,"label",16),r(35,"Cambiar imagen:"),e(),i(36,"input",17),b("change",function(c){return t.uploadImage(c)}),e()(),i(37,"div",18)(38,"button",19),r(39,"Guardar Cambios"),e()()()()),l&2){let a,c,g,_,P;d("@fadeIn",void 0),s(3),d("ngIf",t.mostrarToast),s(),d("formGroup",t.formulario),s(5),d("ngIf",((a=t.formulario.get("titulo"))==null?null:a.touched)&&((a=t.formulario.get("titulo"))==null?null:a.invalid)),s(5),d("ngIf",((c=t.formulario.get("genero"))==null?null:c.touched)&&((c=t.formulario.get("genero"))==null?null:c.invalid)),s(5),d("ngIf",((g=t.formulario.get("anio"))==null?null:g.touched)&&((g=t.formulario.get("anio"))==null?null:g.invalid)),s(5),d("ngIf",((_=t.formulario.get("director"))==null?null:_.touched)&&((_=t.formulario.get("director"))==null?null:_.invalid)),s(8),d("ngIf",(P=t.formulario.get("imagen"))==null?null:P.value),s(6),d("disabled",t.formulario.invalid)}},dependencies:[O,S,Y,F,N,j,w,R,k,G,D],styles:[".formulario[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;background:#1a1a1a;padding:20px;border-radius:10px;color:#fff}.campo[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;flex-direction:column}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:10px;border:1px solid #444;border-radius:5px;background:#111;color:#fff}input[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#00bcd4}button[_ngcontent-%COMP%]{background:#00bcd4;border:none;color:#fff;padding:10px 20px;border-radius:6px;font-size:16px;cursor:pointer;margin-top:10px}button[_ngcontent-%COMP%]:disabled{background:#555;cursor:not-allowed}.error[_ngcontent-%COMP%]{color:#ff4d4d;font-size:13px;margin-top:3px}textarea[_ngcontent-%COMP%]{resize:vertical;height:auto;min-height:80px;overflow-y:auto;line-height:1.4}.boton-centrado[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:20px}.boton-centrado[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:16px;background-color:#3498db;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s}.boton-centrado[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2980b9}.toast[_ngcontent-%COMP%]{position:fixed;bottom:30px;right:30px;background-color:#4caf50;color:#fff;padding:16px 24px;border-radius:8px;box-shadow:0 2px 10px #0000004d;font-size:16px;z-index:9999;animation:_ngcontent-%COMP%_fadein .5s,_ngcontent-%COMP%_fadeout .5s 1.5s}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_fadeout{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(10px)}}"],data:{animation:[y("fadeIn",[E(":enter",[h({opacity:0}),x("500ms ease-in",h({opacity:1}))])])]}})};var Ie=[{path:"",component:v,canActivate:[V("admin")]}];export{Ie as routes};
